<section class="experiences-section" id="experiences">
    <div class="experiences-container">
        <div class="experiences-header">
            <h2 class="experiences-title">{{ homepage.experiences_section.headline }}</h2>
            <p class="experiences-intro">{{ homepage.experiences_section.intro }}</p>
        </div>

        <div class="carousel-wrapper">
            <button class="carousel-arrow carousel-prev" aria-label="Previous experiences">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </button>

            <div class="experiences-carousel">
                {% for exp in homepage.experiences_section.experiences %}
                {% assign img_base = exp.image | replace: '.jpg', '' | replace: '.jpeg', '' | replace: '.png', '' %}
                {% assign is_local = exp.image | slice: 0, 1 %}
                <div class="experience-card">
                    {% if is_local == '/' %}
                    <picture class="experience-image">
                        <source
                            type="image/avif"
                            srcset="{{ img_base }}-640w.avif 640w, {{ img_base }}-1080w.avif 1080w"
                            sizes="(max-width: 768px) 240px, 280px">
                        <source
                            type="image/webp"
                            srcset="{{ img_base }}-640w.webp 640w, {{ img_base }}-1080w.webp 1080w"
                            sizes="(max-width: 768px) 240px, 280px">
                        <img
                            src="{{ img_base }}-640w.webp"
                            alt="{{ exp.title }}"
                            loading="lazy"
                            decoding="async">
                    </picture>
                    {% else %}
                    <div class="experience-image" style="background-image: url('{{ exp.image }}')"></div>
                    {% endif %}
                    <div class="experience-overlay">
                        <h3 class="experience-card-title">{{ exp.title }}</h3>
                        <p class="experience-desc">{{ exp.description }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>

            <button class="carousel-arrow carousel-next" aria-label="Next experiences">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>
        </div>
    </div>
</section>

<style>
.experiences-section {
    background-color: var(--color-white);
    padding: var(--space-12) 0;
    margin-top: var(--space-12);
}

.experiences-container {
    max-width: var(--container-2xl);
    margin: 0 auto;
    padding: 0 var(--space-8);
}

.experiences-header {
    text-align: left;
    margin-bottom: var(--space-8);
}

.experiences-title {
    font-size: 2.5rem;
    font-weight: 400;
    color: black;
    margin-bottom: var(--space-3);
    font-style: normal;
}

.experiences-intro {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    max-width: 600px;
    margin: 0;
    line-height: 1.6;
}

.carousel-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: var(--space-4);
}

.carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--color-white);
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-primary);
    transition: all var(--transition-normal);
}

.carousel-arrow:hover {
    background: var(--color-primary);
    color: var(--color-white);
    transform: translateY(-50%) scale(1.05);
}

.carousel-prev {
    left: -24px;
}

.carousel-next {
    right: -24px;
}

.experiences-carousel {
    display: flex;
    gap: var(--space-5);
    overflow-x: auto;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: var(--space-2) 0;
}

.experiences-carousel::-webkit-scrollbar {
    display: none;
}

.experience-card {
    flex: 0 0 280px;
    height: 380px;
    position: relative;
    border-radius: 16px;
    overflow: hidden;
    scroll-snap-align: start;
    cursor: pointer;
}

.experience-image {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: cover;
    background-position: center;
    transition: filter 0.25s ease-out, transform 0.25s ease-out;
}

picture.experience-image {
    display: block;
}

picture.experience-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transition: filter 0.25s ease-out, transform 0.25s ease-out;
}

.experience-card:hover .experience-image {
    filter: blur(3px);
    transform: scale(1.05);
}

.experience-card:hover picture.experience-image img {
    filter: blur(3px);
    transform: scale(1.05);
}

/* Dark overlay that appears on hover */
.experience-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.35);
    opacity: 0;
    transition: opacity 0.25s ease-out;
    z-index: 1;
}

.experience-card:hover::before {
    opacity: 1;
}

.experience-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-6);
    text-align: center;
    z-index: 2;
}

.experience-card-title {
    font-size: 1.75rem;
    font-weight: 500;
    color: var(--color-white);
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    transition: transform 0.25s ease-out;
    letter-spacing: 0.02em;
}

.experience-card:hover .experience-card-title {
    transform: translateY(-20px);
}

.experience-desc {
    font-size: var(--text-base);
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
    line-height: 1.6;
    max-width: 220px;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.25s ease-out, transform 0.25s ease-out;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
}

.experience-card:hover .experience-desc {
    opacity: 1;
    transform: translateY(0);
}

@media (max-width: 1024px) {
    .carousel-arrow {
        width: 40px;
        height: 40px;
    }

    .carousel-prev {
        left: -12px;
    }

    .carousel-next {
        right: -12px;
    }

    .experience-card {
        flex: 0 0 260px;
        height: 360px;
    }
}

@media (max-width: 768px) {
    .experiences-section {
        padding: var(--space-10) 0;
        margin-top: var(--space-8);
    }

    .experiences-container {
        padding: 0 var(--space-4);
    }

    .experiences-title {
        font-size: 2rem;
    }

    .experiences-intro {
        font-size: var(--text-base);
    }

    .carousel-wrapper {
        margin: 0 calc(-1 * var(--space-4));
        padding: 0 var(--space-4);
    }

    .carousel-arrow {
        display: none;
    }

    .experiences-carousel {
        padding-left: var(--space-4);
        padding-right: var(--space-4);
    }

    .experience-card {
        flex: 0 0 240px;
        height: 320px;
    }

    .experience-card-title {
        font-size: 1.5rem;
    }

    .experience-desc {
        font-size: var(--text-sm);
        max-width: 180px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.experiences-carousel');
    const prevBtn = document.querySelector('.carousel-prev');
    const nextBtn = document.querySelector('.carousel-next');

    if (carousel && prevBtn && nextBtn) {
        const scrollAmount = 300;

        prevBtn.addEventListener('click', function() {
            carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        });

        nextBtn.addEventListener('click', function() {
            carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        });

        // Update arrow visibility based on scroll position
        function updateArrows() {
            const isAtStart = carousel.scrollLeft <= 10;
            const isAtEnd = carousel.scrollLeft >= carousel.scrollWidth - carousel.clientWidth - 10;

            prevBtn.style.opacity = isAtStart ? '0.3' : '1';
            prevBtn.style.pointerEvents = isAtStart ? 'none' : 'auto';
            nextBtn.style.opacity = isAtEnd ? '0.3' : '1';
            nextBtn.style.pointerEvents = isAtEnd ? 'none' : 'auto';
        }

        carousel.addEventListener('scroll', updateArrows);
        window.addEventListener('resize', updateArrows);
        updateArrows();
    }
});
</script>
